<!DOCTYPE html>
<html>

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="MarkBind 2.14.1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CS2030 AY19/20 Semester 2</title>
  <link rel="stylesheet" href="../../../../markbind/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../markbind/css/bootstrap-vue.min.css">
  <link rel="stylesheet" href="../../../../markbind/fontawesome/css/all.min.css">
  <link rel="stylesheet" href="../../../../markbind/glyphicons/css/bootstrap-glyphicons.min.css">
  <link rel="stylesheet" href="../../../../markbind/css/octicons.css">
  <link rel="stylesheet" href="../../../../markbind/css/github.min.css">
  <link rel="stylesheet" href="../../../../markbind/css/markbind.css">
  <link rel="stylesheet" href="/1920-s2/plugins/markbind-plugin-anchors/markbind-plugin-anchors.css">
  <link rel="stylesheet" href="../../../../markbind/layouts/default/styles.css">
  <link rel="stylesheet" href="../../../../markbind/css/page-nav.css">
</head>

<body data-spy="scroll" data-target="#page-nav" data-offset="100">
  <div id="app">
    <header>
      <navbar type="dark" class="temp-navbar">
        <a slot="brand" href="/1920-s2/index.html" title="Home" class="navbar-brand">CS2030 AY19/20 Semester 2</a>
        <div class="nav-link temp-dropdown-placeholder">Peer Learning</div>
        <dropdown class="nav-link temp-dropdown"><template slot="_header">Peer Learning</template>
          <li><a href="/1920-s2/contents/peerlearning/peerlearning.html" class="dropdown-item">Introduction</a></li>
          <li><a href="/1920-s2/contents/peerlearning/textbook.html" class="dropdown-item">Textbook Contributions</a></li>
          <li><a href="/1920-s2/contents/peerlearning/peerlearningtask.html" class="dropdown-item">Peer Learning Tasks</a></li>
          <li><a href="/1920-s2/contents/peerlearning/piazza.html" class="dropdown-item">Piazza Participation</a></li>
        </dropdown>
        <div class="nav-link temp-dropdown-placeholder">Guides</div>
        <dropdown class="nav-link temp-dropdown"><template slot="_header">Guides</template>
          <li><a href="/1920-s2/contents/guides/settingUpLabEnv.html" class="dropdown-item">Setting Up Lab Environment</a></li>
          <li><a href="/1920-s2/contents/guides/settingUpJava.html" class="dropdown-item">Setting Up Java</a></li>
          <li><a href="/1920-s2/contents/guides/settingUpVim.html" class="dropdown-item">Setting Up Vim</a></li>
          <li><a href="/1920-s2/contents/guides/settingUpMacVim.html" class="dropdown-item">Setting Up MacVim</a></li>
          <li><a href="/1920-s2/contents/guides/sunfireLabs.html" class="dropdown-item">Setting Up Sunfire and PE Nodes</a></li>
          <li><a href="/1920-s2/contents/guides/settingUpCheckstyle.html" class="dropdown-item">Setting Up Checkstyle</a></li>
        </dropdown>
        <li><a slot="brand" href="/1920-s2/contents/textbook/textbook.html" class="nav-link">Textbook</a></li>
        <div class="nav-link temp-dropdown-placeholder">Links</div>
        <dropdown class="nav-link temp-dropdown"><template slot="_header">Links</template>
          <li><a href="https://www.comp.nus.edu.sg/~cs2030/style/" class="dropdown-item" target="_blank">CS2030 Java Style Guide</a></li>
          <li><a href="https://www.comp.nus.edu.sg/~cs2030/javadoc/" class="dropdown-item" target="_blank">CS2030 Javadoc Specification</a></li>
          <li><a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk11-downloads-5066655.html" class="dropdown-item" target="_blank">JDK 11 Download Link</a></li>
          <li><a href="https://codecrunch.comp.nus.edu.sg/" class="dropdown-item" target="_blank">Codecrunch</a></li>
          <li><a href="https://github.com/nus-cs2030/1920-s2" class="dropdown-item" target="_blank">Github Repo</a></li>
          <li><a href="https://piazza.com/class/k54zo22zq1t2zc" class="dropdown-item" target="_blank">Piazza Forum</a></li>
        </dropdown>
        <li slot="right">
          <form class="navbar-form">
            <searchbar :data="searchData" placeholder="Search" :on-hit="searchCallback" menu-align-right></searchbar>
          </form>
        </li>
      </navbar>
    </header>
    <div id="flex-body">

      <div id="content-wrapper">
        <br>
        <h1 id="intro-to-asynchronous-programming">Intro to Asynchronous Programming<a class="fa fa-anchor" href="#intro-to-asynchronous-programming" onclick="event.stopPropagation()"></a></h1>
        <br>

        <p><a href="https://github.com/nus-cs2030/1920-s2/edit/master/contents/textbook/lecture04/solidprinciples/DIP.md">Edit the material here! <span aria-hidden="true" class="fas fa-pen"></span></a></p>

        <p>Original Credits go to <a href="https://nus-cs2030.github.io/1718-s2/lec11/index.html">Prof Ooi's AY2017/2018 Semester 2 CS2030 Website</a></p>
        <h2 id="synchronous-vs-asynchronous">Synchronous vs. Asynchronous<a class="fa fa-anchor" href="#synchronous-vs-asynchronous" onclick="event.stopPropagation()"></a></h2>
        <p>In synchronous programming, when we call a method, we expect the method to be executed, and when the method returns, the result of the method is available.</p>
        <pre><code class="hljs Java"><span><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">multiply</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>{<br></span><span>    <span class="hljs-keyword">return</span> x * y;<br></span><span>}<br></span><span><br></span><span><span class="hljs-keyword">int</span> z = multiply(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>);<br></span></code></pre>
        <p>In the simple example above, our code continues executing after, and only after <code>multiply()</code> completes.</p>
        <p>If a method takes a long time to run, however, the execution will delay the execution of subsequent methods, and maybe undesirable.</p>
        <p>Asynchronous call to a method allows execution to continue immediately after calling the method, so that we can continue executing the rest of our code, while the long-running method is off doing its job.</p>
        <p>You have seen examples of asynchronous calls:</p>
        <pre><code class="hljs Java"><span>task = <span class="hljs-keyword">new</span> MatrixMultiplyerTask(m1, m2);<br></span><span>task.fork();<br></span></code></pre>
        <p>The call above returns immediately even before the matrix multiplication is complete. We can later return to this task, and call <code>task.join()</code> to get the result (waiting for it if necessary).</p>
        <h2 id="future">Future<a class="fa fa-anchor" href="#future" onclick="event.stopPropagation()"></a></h2>
        <p>Let's look at the <code>Future</code> interface a bit more. <code>Future&lt;T&gt;</code> represents the result (of type <code>T</code>) of an asynchronous task that may not be available yet. It has five simple operations:</p>
        <ul>
          <li><code>get()</code> returns the result of the computation (waiting for it if needed).</li>
          <li><code>get(timeout, unit)</code> returns the result of the computation (waiting for up to the timeout period if needed).</li>
          <li><code>cancel(interrupt)</code> tries to cancel the task -- if <code>interrupt</code> is true, cancel even if the task has started. Otherwise, cancel only if the task is still waiting to get started.</li>
          <li><code>isCancelled()</code> returns <code>true</code> of the task has been cancelled.</li>
          <li><code>isDone()</code> returns <code>true</code> if the task has been completed.</li>
        </ul>
        <box type="warning">
          Scala's <code>Future</code> is more powerful -- it allows us to specify what to do when the task completes, and it hands abnormal completions (e.g., exceptions).
          Python 3.2 supports <code>Future</code> through <a href="https://docs.python.org/3/library/concurrent.futures.html">concurrent.futures</a> module.
          C++11 supports <a href="/1920-s2/contents/textbook/lecture11/asyncIntro/(http:/en.cppreference.com/w/cpp/thread/future">std::future</a></box>
        <h2 id="completablefuture">CompletableFuture<a class="fa fa-anchor" href="#completablefuture" onclick="event.stopPropagation()"></a></h2>
        <p>We can try to check every second to see if the task is done. However, this <strong>might not be optimal</strong>.</p>
        <p>For some applications, the response time is critical, and we would like to know as soon as a task is done. For instance, response time is important in stock trading applications and web services.</p>
        <p>One way to do so, is to sleep for a shorter duration. Or even not sleeping all together:</p>
        <pre><code class="hljs Java"><span>task.fork();<br></span><span><span class="hljs-keyword">while</span> (!task.isDone()) {<br></span><span>    System.out.print(<span class="hljs-string">"."</span>);<br></span><span>}<br></span><span>System.out.print(<span class="hljs-string">"done"</span>);<br></span></code></pre>
        <p>This is problematic in many ways, besides printing out too many dots:</p>
        <ul>
          <li>this is known as <em>busy waiting</em> -- and it occupies the CPU <a href="https://en.wikipedia.org/wiki/Central_processing_unit">Central Processing Unit</a> while doing nothing. Such code should be avoided at all cost.</li>
          <li>we may want to continue doing other things besides printing out &quot;.&quot;s, so the code won't be a simple for loop anymore. We can do something like this instead:</li>
        </ul>
        <pre><code class="hljs Java"><span>task.fork();<br></span><span><span class="hljs-keyword">if</span> (!task.isDone()) {<br></span><span>    <span class="hljs-comment">// do something</span><br></span><span>} <span class="hljs-keyword">else</span> {<br></span><span>    task.join();<br></span><span>}<br></span><span><span class="hljs-keyword">if</span> (!task.isDone()) {<br></span><span>    <span class="hljs-comment">// do something else</span><br></span><span>} <span class="hljs-keyword">else</span> {<br></span><span>    task.join();<br></span><span>}<br></span><span><span class="hljs-keyword">if</span> (!task.isDone()) {<br></span><span>    <span class="hljs-comment">// do yet something else</span><br></span><span>} <span class="hljs-keyword">else</span> {<br></span><span>    task.join();<br></span><span>}<br></span></code></pre>
        <p>You can see that the code gets out of hand quickly, and this is only if we have one asynchronous call!</p>
        <p>What we need is have a way to specify a <em>callback</em>. A callback is basically a method that will be executed when a certain event happens. In this case, we need to specify a callback when an asynchronous task is complete. This way, we can just call an asynchronous task, specify what to do when the task is completed, and forget about it. We do not need to check again and again if the task is done.</p>
        <p>To do exactly this, Java 8 introduces the class <code>CompletableFuture&lt;V&gt;</code>, which implements the <code>Future&lt;V&gt;</code> interface. Thus, just like <code>Future&lt;V&gt;</code>, a <code>CompletableFuture&lt;V&gt;</code> object returns a value of type <code>V</code> when it completes. But <code>CompletableFuture&lt;V&gt;</code> is more powerful, it allows us to specify an asynchronous task, and an action to perform when the task completes.</p>
        <p>The notion of &quot;complete&quot; is important for <code>CompletableFuture</code>. If the <code>CompletableFuture</code> is complete, then the value to return is available. We can create an already-completed <code>CompletableFuture</code>, passing in a value, or a yet-to-be-completed <code>CompletableFuture</code>, by passing in a function to be executed asynchronously. When this function returns, the <code>CompletableFuture</code> completes.</p>
        <p>To create a <code>CompletableFuture</code> object, we can call one of its static method. For instance, <code>supplyAsync</code> takes in a <code>Supplier</code>:</p>
        <pre><code class="hljs Java"><span>CompletableFuture&lt;Matrix&gt; future = CompletableFuture.supplyAsync(() -&gt; m1.multiply(m2));<br></span></code></pre>
        <p>As explained above, <code>future</code> completes when <code>m1.multiply(m2)</code> returns.<br>
          Let's say that we want to print out the result with a <code>Consumer</code> when <code>future</code> completes, we can use the <code>thenAccept</code> method:</p>
        <pre><code class="hljs Java"><span>future.thenAccept(System.out::println);<br></span></code></pre>
        <p>Or, you can use the oneliner:</p>
        <pre><code class="hljs Java"><span>CompletableFuture<br></span><span>    .supplyAsync(() -&gt; m1.multiply(m2))<br></span><span>    .thenAccept(System.out::println);<br></span></code></pre>
        <h2 id="waiting-for-completion">Waiting for Completion<a class="fa fa-anchor" href="#waiting-for-completion" onclick="event.stopPropagation()"></a></h2>
        <p>If you want your code to block until a <code>CompletableFuture</code> completes, you can call <code>join()</code>.</p>
        <pre><code class="hljs Java"><span>m = future.join();<br></span></code></pre>
        <p>Suppose you have several <code>CompletableFuture</code> objects, say <code>cf1</code>, <code>cf2</code>, and <code>cf3</code>, and you want to block until all of these <code>CompletableFuture</code> completes. You can create a composite <code>CompletableFuture</code> objects, using <code>allOf()</code>:</p>
        <pre><code class="hljs Java"><span>CompletableFuture.allOf(cf1, cf2, cf3).join();<br></span></code></pre>
        <p>The object created by <code>CompletableFuture.allOf(cf1, cf2, cf3)</code> completes, only after all of <code>cf1</code>, <code>cf2</code>, <code>cf3</code> completes.</p>
        <p>There is also a <code>anyOf</code>, for cases where it is sufficient for any one of the <code>CompletableFuture</code> to complete:</p>
        <pre><code class="hljs Java"><span>CompletableFuture.anyOf(cf1, cf2, cf3).join();<br></span></code></pre>
        <p>To learn more, <a href="/1920-s2/contents/textbook/lecture11/asyncIntro/asyncIntro2.html">click here</a></p>
      </div>


      <nav id="page-nav" class="navbar navbar-light bg-transparent">
        <div class="border-left-grey nav-inner position-sticky slim-scroll">

          <nav class="nav nav-pills flex-column my-0 small no-flex-wrap">
            <a class="nav-link py-1" href="#intro-to-asynchronous-programming">Intro to Asynchronous Programming&#x200E;</a>
            <nav class="nav nav-pills flex-column my-0 nested no-flex-wrap">
              <a class="nav-link py-1" href="#synchronous-vs-asynchronous">Synchronous vs. Asynchronous&#x200E;</a>
              <a class="nav-link py-1" href="#future">Future&#x200E;</a>
              <a class="nav-link py-1" href="#completablefuture">CompletableFuture&#x200E;</a>
              <a class="nav-link py-1" href="#waiting-for-completion">Waiting for Completion&#x200E;</a>
            </nav>

          </nav>
        </div>
      </nav>
    </div>
    <footer>

      <div class="text-center">
        <small>Generated by <a href="https://markbind.org/">MarkBind 2.14.1</a> on Sun, May 10, 2020, 2:29:49 PM UTC</small></div>
    </footer>
  </div>
</body>
<script src="../../../../markbind/js/vue.min.js"></script>
<script src="../../../../markbind/js/vue-strap.min.js"></script>
<script src="../../../../markbind/js/bootstrap-utility.min.js"></script>
<script src="../../../../markbind/js/polyfill.min.js"></script>
<script src="../../../../markbind/js/bootstrap-vue.min.js"></script>
<script>
  const baseUrl = '/1920-s2'
  const enableSearch = true
</script>
<script src="../../../../markbind/js/setup.js"></script>
<script src="../../../../markbind/layouts/default/scripts.js"></script>

</html>